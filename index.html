<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>F√°brica Turbo V11 (Sync Fix)</title>
    
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/robot-2.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { background-color: #000; background-image: radial-gradient(circle at 50% 0%, #111827 0%, #000 100%); color: white; font-family: system-ui, sans-serif; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(20, 25, 40, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
        .hidden-view { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .check-card input:checked + div { border-color: #3b82f6; background: rgba(59, 130, 246, 0.15); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2); }
        .check-card input:checked + div i { color: #60a5fa; transform: scale(1.1); }
        .processing { border-color: #22c55e; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
        .scroll { overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .scroll::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
    
    <script>
        function safeHide(id) { const el = document.getElementById(id); if(el) el.classList.add('hidden'); }
        function safeShow(id) { const el = document.getElementById(id); if(el) el.classList.remove('hidden'); }
        function safeVal(id, val) { const el = document.getElementById(id); if(el) el.value = val; }
        function safeClass(id, action, className) {
            const el = document.getElementById(id);
            if(el) {
                if (action === 'add') el.classList.add(className);
                if (action === 'remove') el.classList.remove(className);
            }
        }
        function showView(targetId) {
            ['view-login', 'view-dashboard', 'view-editor'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden-view');
            });
            const target = document.getElementById(targetId);
            if (target) target.classList.remove('hidden-view');
        }
    </script>
</head>

<body class="flex flex-col h-[100dvh]">

    <div id="view-login" class="flex-1 flex flex-col justify-center items-center p-6 hidden-view scroll fade-in">
        <div class="glass p-8 rounded-3xl w-full max-w-md text-center shadow-2xl border-t-4 border-blue-500">
            <i class="fas fa-robot text-5xl text-blue-500 mb-4 block"></i>
            <h1 class="text-2xl font-bold mb-2">F√°brica V11</h1>
            <p class="text-gray-400 text-sm mb-6">Painel de Controle</p>
            <input type="password" id="input-token" placeholder="Cole seu Token GitHub" class="w-full bg-black/50 border border-gray-700 rounded-xl p-3 text-center text-green-400 focus:border-green-500 outline-none mb-4 text-sm font-mono shadow-inner">
            <button onclick="salvarToken()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg transition active:scale-95 mb-4">ENTRAR</button>
            <button onclick="resetarDados()" class="text-[10px] text-red-400 hover:text-red-300 underline cursor-pointer">Limpar Dados</button>
        </div>
    </div>

    <div id="view-dashboard" class="flex-1 flex flex-col hidden-view h-full">
        <div class="p-5 shrink-0 flex justify-between items-end border-b border-gray-800 bg-black/40 backdrop-blur-md pt-8">
            <div><h1 class="text-xl font-bold text-blue-400">Meus Apps</h1><p class="text-gray-500 text-xs">Gerenciador Sync</p></div>
            <button onclick="logout()" class="text-gray-500 hover:text-white transition p-2"><i class="fas fa-sign-out-alt"></i></button>
        </div>
        <div id="apps-list" class="grid grid-cols-2 gap-3 p-4 scroll flex-1 pb-32 content-start"></div>
        <button onclick="novoApp()" class="fixed bottom-8 right-6 w-14 h-14 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-2xl shadow-lg flex items-center justify-center text-white text-2xl z-50 hover:scale-105 active:scale-90 transition border border-white/20"><i class="fas fa-plus"></i></button>
    </div>

    <div id="view-editor" class="flex-1 flex flex-col hidden-view h-full bg-black relative">
        <div class="p-4 shrink-0 flex items-center border-b border-gray-800 bg-gray-900/90 z-20 shadow-lg pt-6">
            <button onclick="voltarDashboard()" class="p-2 mr-3 text-gray-400 hover:text-white bg-gray-800 rounded-lg transition active:scale-90 border border-gray-700"><i class="fas fa-chevron-left"></i></button>
            <h2 id="editor-title" class="text-lg font-bold">Novo App</h2>
        </div>

        <div class="flex-1 scroll p-5 space-y-6 pb-48">
            <input type="hidden" id="edit-id">
            <div class="bg-gray-900/50 p-4 rounded-xl border border-gray-800 space-y-3">
                <input type="text" id="app-name" placeholder="Nome (Ex: Minha Loja)" class="w-full bg-black/60 border border-gray-700 rounded-lg p-3 text-white focus:border-blue-500 outline-none mt-1 font-bold shadow-inner placeholder-gray-700 transition">
                <div class="flex gap-2">
                    <input type="text" id="app-pkg" placeholder="ID (com.loja)" class="w-2/3 bg-black/60 border border-gray-700 rounded-lg p-2 text-xs font-mono text-gray-300 outline-none mt-1">
                    <input type="text" id="app-ver" placeholder="1.0.0" class="w-1/3 bg-black/60 border border-gray-700 rounded-lg p-2 text-xs font-mono text-center text-gray-300 outline-none mt-1">
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <div class="drop-zone bg-gray-900 border border-gray-700 border-dashed rounded-xl p-2 h-24 flex flex-col items-center justify-center relative cursor-pointer" onclick="document.getElementById('f-icon').click()">
                    <img id="preview-icon" class="hidden w-full h-full object-cover rounded opacity-80 absolute inset-0">
                    <div id="icon-placeholder" class="text-center pointer-events-none">
                        <i class="fas fa-image text-xl text-gray-500 mb-1"></i><p class="text-[8px] text-gray-400 font-bold uppercase">√çcone</p>
                    </div>
                    <input type="file" id="f-icon" accept="image/png" class="hidden" onchange="previewFile(this, 'preview-icon', 'icon-placeholder')">
                    <div id="icon-dot" class="absolute top-2 right-2 w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e] hidden z-20"></div>
                </div>
                <div class="drop-zone bg-gray-900 border border-gray-700 border-dashed rounded-xl p-2 h-24 flex flex-col items-center justify-center relative cursor-pointer" onclick="document.getElementById('f-splash').click()">
                    <img id="preview-splash" class="hidden w-full h-full object-cover rounded opacity-80 absolute inset-0">
                    <div id="splash-placeholder" class="text-center pointer-events-none">
                        <i class="fas fa-mobile-alt text-xl text-gray-500 mb-1"></i><p class="text-[8px] text-gray-400 font-bold uppercase">Splash</p>
                    </div>
                    <input type="file" id="f-splash" accept="image/png" class="hidden" onchange="previewFile(this, 'preview-splash', 'splash-placeholder')">
                    <div id="splash-dot" class="absolute top-2 right-2 w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e] hidden z-20"></div>
                </div>
                <div class="drop-zone bg-gray-900 border border-gray-700 border-dashed rounded-xl p-2 h-24 flex flex-col items-center justify-center relative cursor-pointer" onclick="document.getElementById('f-index').click()">
                    <div id="preview-index" class="hidden w-full h-full bg-green-500/20 flex items-center justify-center border-2 border-green-500 rounded-xl absolute inset-0"><i class="fas fa-check text-2xl text-green-500"></i></div>
                    <div id="index-placeholder" class="text-center pointer-events-none">
                        <i class="fas fa-code text-xl text-gray-500 mb-1"></i><p class="text-[8px] text-gray-400 font-bold uppercase">Index</p>
                    </div>
                    <input type="file" id="f-index" accept=".html" class="hidden" onchange="previewFile(this, 'preview-index', 'index-placeholder')">
                    <div id="index-dot" class="absolute top-2 right-2 w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e] hidden z-20"></div>
                </div>
            </div>

            <div>
                <label class="text-[10px] text-blue-500 font-bold uppercase ml-1 mb-3 block">Recursos</label>
                <div class="grid grid-cols-4 gap-2">
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-notif" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-bell text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">Notif</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-cam" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-camera text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">Cam</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-gps" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-map-marker-alt text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">GPS</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-full" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-expand text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">Tela</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-vib" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-wave-square text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">Vib</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-mic" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-microphone text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">Mic</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-flash" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-lightbulb text-[10px] text-gray-500 mb-1"></i><span class="text-[7px] font-bold">Luz</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-browser" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-globe text-[10px] text-gray-400 mb-1"></i><span class="text-[7px] font-bold">Web</span></div></label>
                    <label class="check-card relative cursor-pointer"><input type="checkbox" id="c-ins" class="hidden"><div class="bg-gray-900 border border-gray-700 rounded-lg h-12 flex flex-col items-center justify-center"><i class="fas fa-eye text-[10px] text-gray-400 mb-1"></i><span class="text-[7px] font-bold">Wake</span></div></label>
                </div>
            </div>
            
            <div id="status-log" class="hidden bg-black/80 rounded-xl p-3 text-[10px] font-mono text-green-400 h-24 border border-gray-800 shadow-inner scroll"></div>
        </div>

        <div class="absolute bottom-0 left-0 w-full bg-black/95 border-t border-gray-800 p-4 z-30 shadow-2xl backdrop-blur-lg">
            <div class="max-w-xl mx-auto grid grid-cols-3 gap-3">
                <button onclick="save()" class="bg-gray-800 text-gray-300 font-bold py-3.5 rounded-xl text-xs hover:bg-gray-700 transition active:scale-95 border border-gray-700 shadow">SALVAR</button>
                <button id="btn-build" onclick="fabricarApp()" class="col-span-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-3.5 rounded-xl text-xs hover:scale-[1.02] transition shadow-lg flex items-center justify-center space-x-2 active:scale-95 border border-white/10"><i class="fas fa-hammer"></i> <span>FABRICAR APK</span></button>
            </div>
            <a id="btn-dl" href="#" target="_blank" class="hidden mt-3 w-full bg-green-600 text-white font-bold py-3 rounded-xl text-center text-xs block shadow-lg transition transform active:scale-95"><i class="fas fa-download mr-1"></i> BAIXAR (TURBO)</a>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES GLOBAIS
        const GITHUB_USER = "gamerkaua00";
        const GITHUB_REPO = "Maquina-Apks";
        const CFG = { u: GITHUB_USER, r: GITHUB_REPO };

        let MEUS_APPS = JSON.parse(localStorage.getItem('ma') || '[]');
        const $ = (id) => document.getElementById(id);

        // UTEIS
        function safeB64(str) {
            return window.btoa(unescape(encodeURIComponent(str)));
        }

        function previewFile(input, previewId, placeholderId) {
            const file = input.files[0];
            if(file){
                if(input.id !== 'f-index') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = $(previewId);
                        if(img) { img.src = e.target.result; img.classList.remove('hidden'); }
                        const ph = $(placeholderId);
                        if(ph) ph.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    safeClass('preview-index', 'remove', 'hidden');
                    safeClass('index-placeholder', 'add', 'hidden');
                }
                const dotId = input.id.replace('f-','') + '-dot';
                safeClass(dotId, 'remove', 'hidden');
            }
        }

        window.onload=()=>{
            const t=localStorage.getItem('gt'); const bp=localStorage.getItem('bp');
            if(t){ showView('view-dashboard'); list(); if(bp){ showView('view-editor'); safeClass('status-log','remove','hidden'); const logEl=$('status-log'); if(logEl) logEl.innerHTML='<div class="text-yellow-400 pb-1 mb-1 font-bold">> Reconectando...</div>'; monitor(t); }
            }else showView('view-login');
        };
        
        function salvarToken(){ const t=$('input-token').value.trim(); if(t.startsWith('ghp_')){localStorage.setItem('gt',t);showView('view-dashboard');list();}else alert("Token inv√°lido! Deve come√ßar com ghp_"); }
        function logout(){ if(confirm("Sair?")){localStorage.removeItem('gt');location.reload();} }
        function resetarDados(){ if(confirm("Apagar tudo?")){localStorage.clear();location.reload();} }
        function voltarDashboard(){ localStorage.removeItem('bp'); showView('view-dashboard'); list(); }

        function list(){
            const l=$('apps-list'); if(!l) return; l.innerHTML='';
            if(!MEUS_APPS.length) l.innerHTML='<div class="col-span-2 text-center py-20 text-gray-700 opacity-60">Nenhum projeto.</div>';
            MEUS_APPS.forEach(a=>{
                const i=a.icon||'https://img.icons8.com/fluency/48/android-os.png';
                const b=a.url?`<a href="${a.url}" target="_blank" onclick="event.stopPropagation()" class="absolute bottom-2 left-2 bg-green-600 text-white text-[9px] px-2 py-1 rounded shadow z-10 font-bold tracking-wide">BAIXAR</a>`:'';
                l.innerHTML+=`<div onclick="openApp(${a.id})" class="bg-gray-900 rounded-xl p-3 relative group border border-gray-800 hover:border-blue-500 transition cursor-pointer shadow-lg"><div class="flex flex-col items-center"><img src="${i}" class="w-10 h-10 mb-2 rounded bg-black object-contain"><h3 class="font-bold text-xs truncate w-full text-center">${a.name}</h3><div class="text-[9px] text-gray-500">${a.ver||'v1.0'}</div></div>${b}<button onclick="event.stopPropagation();del(${a.id})" class="absolute top-2 right-2 text-gray-600 hover:text-red-500 w-6 h-6 flex items-center justify-center rounded-full hover:bg-white/5 transition"><i class="fas fa-times"></i></button></div>`;
            });
        }

        function novoApp(){ 
            safeVal('edit-id', ''); safeVal('app-name', ''); safeVal('app-pkg', ''); safeVal('app-ver', '1.0.0');
            ['f-icon','f-index','f-splash'].forEach(i=>{ const el=$(i); if(el) el.value=''; });
            ['preview-icon','preview-splash','preview-index'].forEach(i=>safeClass(i,'add','hidden'));
            ['icon-placeholder','splash-placeholder','index-placeholder'].forEach(i=>safeClass(i,'remove','hidden'));
            ['icon-dot','index-dot','splash-dot'].forEach(i=>safeClass(i,'add','hidden'));
            safeClass('status-log','add','hidden'); safeClass('btn-dl','add','hidden');
            safeClass('btn-build','remove','hidden');
            const et = $('editor-title'); if(et) et.innerText = "Novo Projeto";
            document.querySelectorAll('input[type=checkbox]').forEach(c=>c.checked=false);
            showView('view-editor');
        }

        function openApp(id){
            const a=MEUS_APPS.find(x=>x.id===id); if(!a)return;
            safeVal('edit-id', a.id); safeVal('app-name', a.name); safeVal('app-pkg', a.pkg||''); safeVal('app-ver', a.ver||'1.0.0');
            const et=$('editor-title'); if(et) et.innerText=a.name;
            ['f-icon','f-index','f-splash'].forEach(i=>{ const el=$(i); if(el) el.value=''; });
            if(a.feat) for(let k in a.feat) { const el=$('c-'+k); if(el) el.checked=a.feat[k]; }
            
            if(a.icon) { if($('preview-icon')) { $('preview-icon').src=`data:image/png;base64,${a.icon}`; safeClass('preview-icon','remove','hidden'); safeClass('icon-placeholder','add','hidden'); safeClass('icon-dot','remove','hidden'); } }
            if(a.html) { safeClass('preview-index','remove','hidden'); safeClass('index-placeholder','add','hidden'); safeClass('index-dot','remove','hidden'); }
            if(a.splash) { if($('preview-splash')) { $('preview-splash').src=`data:image/png;base64,${a.splash}`; safeClass('preview-splash','remove','hidden'); safeClass('splash-placeholder','add','hidden'); safeClass('splash-dot','remove','hidden'); } }
            showView('view-editor');
        }

        function del(id){ if(confirm("Apagar?")){ MEUS_APPS=MEUS_APPS.filter(x=>x.id!==id); localStorage.setItem('ma',JSON.stringify(MEUS_APPS)); list(); } }
        const b64 = f => new Promise((r,j)=>{const d=new FileReader();d.readAsDataURL(f);d.onload=()=>r(d.result.split(',')[1]);d.onerror=j;});

        async function save(url=null){
            const name=$('app-name').value; if(!name) return alert("D√™ um nome!");
            const id=$('edit-id').value; const fi=$('f-icon').files[0]; const fh=$('f-index').files[0]; const fs=$('f-splash').files[0];
            let a=id?MEUS_APPS.find(x=>x.id==id):null; if(!a){a={id:Date.now()};MEUS_APPS.push(a);}
            a.name=name; a.date=Date.now(); a.pkg=$('app-pkg').value; a.ver=$('app-ver').value;
            if(url) a.url=url;
            a.feat={}; document.querySelectorAll('input[type=checkbox]').forEach(c=>a.feat[c.id.replace('c-','')] = c.checked);
            if(fi)a.icon=await b64(fi); if(fh)a.html=await b64(fh); if(fs)a.splash=await b64(fs);
            const idx=MEUS_APPS.findIndex(x=>x.id===a.id); if(idx>=0)MEUS_APPS[idx]=a; else MEUS_APPS.push(a);
            localStorage.setItem('ma',JSON.stringify(MEUS_APPS));
            if(!url){alert("‚úÖ Salvo!"); voltarDashboard();}
        }

        const logger = (m, e) => {
            const b = $('status-log'); if(!b) return;
            const t = new Date().toLocaleTimeString('pt-BR',{hour12:false});
            b.innerHTML += `<div class="${e?'text-red-400':'text-green-400'} border-b border-gray-800 pb-1 mb-1 font-mono leading-tight"><span class="text-gray-500 text-[9px]">[${t}]</span> ${m}</div>`;
            b.scrollTop = b.scrollHeight;
        };

        // --- FABRICA√á√ÉO CORRIGIDA ---
        async function fabricarApp() {
            const token = localStorage.getItem('gt');
            if(!token) return alert("Sem token!");
            
            const name = $('app-name').value || "Meu App";
            const pkg = $('app-pkg').value || "com.myapp";
            const ver = $('app-ver').value || "1.0.0";
            const id = $('edit-id').value; 
            let a = id ? MEUS_APPS.find(x => x.id == id) : {};
            
            const iconFile = $('f-icon').files[0];
            const indexFile = $('f-index').files[0];
            const splashFile = $('f-splash').files[0];
            
            let iconData = iconFile ? await b64(iconFile) : a.icon;
            let indexData = indexFile ? await b64(indexFile) : a.html;
            let splashData = splashFile ? await b64(splashFile) : a.splash;

            if(!indexData) return alert("Erro: O arquivo Index.html √© obrigat√≥rio!");

            // Cria o objeto JSON com TUDO que o bot precisa
            const ft={
                appName: name,
                packageId: pkg, 
                version: ver
            };
            
            document.querySelectorAll('input[type=checkbox]').forEach(c => { 
                const key = c.id.replace('c-', '');
                const map = {notif:'notification',vib:'vibration',cam:'camera',gps:'geolocation',full:'fullscreen',flash:'flashlight',mic:'microphone',ins:'insomnia',file:'file',browser:'browser'};
                ft[map[key]||key] = c.checked; 
            });

            const btn=$('btn-build'); safeClass('status-log','remove','hidden'); 
            const logBox = $('status-log'); if(logBox) logBox.innerHTML='';
            if(btn) { btn.disabled=true; btn.innerHTML='<i class="fas fa-spinner fa-spin"></i> ENVIANDO...'; }

            try {
                logger("üì° Conectando...");
                // 1. Upload do Index (obrigat√≥rio)
                await up(token, "www/index.html", indexData, "Update Index [skip ci]");
                
                // 2. Upload de Imagens (se houver)
                if(iconData) await up(token, "www/icon.png", iconData, "Update Icon [skip ci]");
                if(splashData) await up(token, "www/splash.png", splashData, "Update Splash [skip ci]");
                
                // 3. Upload do features.json (Dispara o Bot)
                // Usando safeB64 para evitar erros de acentua√ß√£o no JSON
                logger("‚öôÔ∏è Configurando Bot...");
                await up(token, "features.json", safeB64(JSON.stringify(ft)), `Build: ${name}`);
                
                logger("‚úÖ ORDEM ENVIADA!");
                
                if(!id){const newId=Date.now(); $('edit-id').value=newId; await save();} else await save();
                localStorage.setItem('bp','1');
                monitor(token);
            } catch(e){ 
                console.error(e);
                logger("Erro: " + e.message, 1); 
                if(btn){ btn.disabled=false; btn.innerHTML="TENTAR NOVAMENTE"; } 
            }
        }

        async function up(t,p,c,m){ 
            const u=`https://api.github.com/repos/${CFG.u}/${CFG.r}/contents/${p}`; 
            let s=null; 
            try{
                const r=await fetch(u,{headers:{Authorization:`token ${t}`}});
                if(r.ok)s=(await r.json()).sha;
            }catch(e){} 
            
            const body = {
                message: m,
                content: c,
                branch: "main"
            };
            if(s) body.sha = s;

            const res=await fetch(u,{
                method:'PUT',
                headers:{Authorization:`token ${t}`,'Content-Type':'application/json'},
                body:JSON.stringify(body)
            }); 
            if(!res.ok) throw new Error("Falha upload: "+p); 
        }

        async function monitor(t){
            const btn=$('btn-build'); if(btn){ btn.innerHTML="FABRICANDO... (Aguarde)"; btn.classList.add('processing'); }
            let att=0;
            const i=setInterval(async()=>{
                att++;
                try{
                    const r=await fetch(`https://api.github.com/repos/${CFG.u}/${CFG.r}/actions/runs?per_page=1`,{headers:{Authorization:`token ${t}`}});
                    const d=await r.json();
                    if(d.workflow_runs?.[0]){
                        const run=d.workflow_runs[0];
                        if(run.status==="completed"){
                            clearInterval(i); if(btn) btn.classList.remove('processing'); localStorage.removeItem('bp');
                            if(run.conclusion==="success"){ logger("‚ú® SUCESSO! Gerando link..."); await link(t); }
                            else{ logger("‚ùå Falha no Build Interno",1); if(btn){ btn.disabled=false; btn.innerHTML="ERRO NA F√ÅBRICA"; } }
                        } else { if(att%4===0) logger(`üî® Processando... [${run.status}]`); }
                    }
                }catch(e){}
                if(att>120){clearInterval(i); logger("Tempo limite excedido",1); if(btn){ btn.disabled=false; btn.innerHTML="TIMEOUT"; }}
            },5000); // 5s check
        }

        async function link(t){
            try{
                const r=await fetch(`https://api.github.com/repos/${CFG.u}/${CFG.r}/releases/latest`,{headers:{Authorization:`token ${t}`}});
                const d=await r.json();
                const url=d.html_url; 
                const direct=d.assets?.[0]?.browser_download_url;

                safeClass('btn-build','add','hidden');
                const btnDown=$('btn-dl');
                
                if(direct){ 
                    btnDown.href=direct; 
                    safeClass('btn-dl','remove','hidden'); 
                    logger("‚úÖ DOWNLOAD PRONTO!"); 
                    save(direct); 
                } else if(url) {
                    btnDown.href=url;
                    safeClass('btn-dl','remove','hidden');
                    btnDown.innerHTML = "VER NO GITHUB";
                }
            }catch(e){logger("Erro ao pegar link",1);}
        }
    </script>
</body>
</html>
