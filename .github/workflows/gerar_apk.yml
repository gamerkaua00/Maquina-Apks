name: FÃ¡brica TURBO V8 (Plugins + Ãcone) ğŸš€

on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Baixando CÃ³digo
      uses: actions/checkout@v3

    - name: â˜• Configurando Java 17
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: ğŸ“¦ Instalando Cordova
      run: |
        npm install -g cordova

    - name: ğŸ—ï¸ Criando a Base do App
      run: |
        # Cria o projeto
        cordova create app-temp com.kaua.app "Seu App Turbo"
        
        # Limpa o exemplo padrÃ£o e copia SEU site
        rm -rf app-temp/www/*
        cp -r www/* app-temp/www/

    - name: ğŸ¨ Configurando Ãcone AutomÃ¡tico
      run: |
        cd app-temp
        # Verifica se existe um icon.png na pasta do site
        if [ -f "www/icon.png" ]; then
          echo "ğŸ”¥ Ãcone personalizado encontrado! Aplicando..."
          # Copia para a raiz
          cp www/icon.png .
          # Adiciona a tag de Ã­cone no config.xml usando um comando de substituiÃ§Ã£o (sed)
          sed -i '/<content src="index.html" \/>/a <icon src="icon.png" />' config.xml
        else
          echo "âš ï¸ Nenhum icon.png encontrado. Usando padrÃ£o."
        fi

    - name: ğŸ”Œ Instalando Superpoderes (Plugins)
      run: |
        cd app-temp
        cordova platform add android
        
        # 1. Resolve tela branca e login (Essencial)
        cordova plugin add cordova-plugin-ionic-webview
        
        # 2. Permite VibraÃ§Ã£o do celular
        cordova plugin add cordova-plugin-vibration
        
        # 3. NotificaÃ§Ãµes Locais (Avisos agendados)
        cordova plugin add cordova-plugin-local-notifications
        
        # 4. Caixas de DiÃ¡logo Nativas (Popups bonitos)
        cordova plugin add cordova-plugin-dialogs

    - name: ğŸ“± Compilando APK (Modo InstalaÃ§Ã£o FÃ¡cil)
      run: |
        cd app-temp
        # Gera o APK Debug (que seu celular aceita instalar)
        cordova build android --debug -- --gradleArg=-PcdvMinSdkVersion=24 --packageType=apk

    - name: ğŸ“¤ Entregando o APK
      uses: actions/upload-artifact@v4
      with:
        name: app-turbo-debug
        path: app-temp/platforms/android/app/build/outputs/apk/debug/app-debug.apk
